<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">
<head>
  <title th:text = "${title}"/>

  <!-- Добавление CSS файла Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
  <!-- Добавление JavaScript файла Leaflet -->
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <style>
    html, body, #map {
      height: 100%;
      width: 100%;
      margin: 0;
      padding: 0;
    }
  </style>
</head>
<body onload="page_loaded();">
<!-- Создание контейнера для карты -->
<div id="map"></div>

<script>

  const TRACK_COORDINATES_URL = "localhost:8080/geodata/all";

  function page_loaded() {
    myIcon = L.icon({ //параметры отображения маркера
      iconUrl: "https://files.geotree.ru/leaflet/markers/blue.png",
      iconSize: [25, 41],
      iconAnchor: [12, 41],
      popupAnchor: [0, 0]
    });
    let center={lon: 56.183934, lat: 58.007073}; // Камский мост
    map = L.map("map", {closePopupOnClick:false} ).setView(center, 14); //установить центр карты и масштаб
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 18,
      attribution: "&copy; <a href='https://openstreetmap.org/copyright'>OpenStreetMap contributors</a>"
    }).addTo(map);

    getCoordinates();
  }


  function getCoordinates() {
    // Запрос на получение GPS трека

    fetch(TRACK_COORDINATES_URL)
            .then(response => {
              return response.json()
            })
            .then(data => {
              // Создаем массив точек трека
              //console.log('data = ' + data);

              const trackPoints = data.map(coord => [coord.lon, coord.lat]);

              // Отображаем трек на карте
              L.polyline(trackPoints, {color: 'blue'}).addTo(map);

              // Устанавливаем вид карты на трек
              map.fitBounds(trackPoints);
            })
            .catch(e => console.error(e));
  }


</script>
</body>
</html>